const t=(t,o)=>o.match(/.{4}/g).map((o=>{const e=o.charCodeAt(0)-35,n=o.charCodeAt(1)-35,r=92*o.charCodeAt(2)+o.charCodeAt(3)-3255,s=r>>5;return{i:t,c:8*(n*s+e*(s+1)),g:e?[[n,s],[e,s+1]]:[[n,s]],s:31&r}})),o=[t(1,"#$)b#$.y#$6>#$?'#$Hq#%:q#%>C#%E##%Ka%%:q#'?G%%C;#'HQ$&KA$(AQ$(EC($HS$(M)'&J[(&HS''K_*%Iw('MI')L%'+H1%-J{'+Mi-&L%**Ka-(KA&0KA#4KA$4KA)0KA*/MI1)MI'4Mi5'Mi'7L%)6LE"),t(0,"#$(a#$,w#$2Y#%.A#%27#',W#'-}%%0M%&/i$'29'$4e%)/i$+0-('13((1S&*2{$-3?',29.&2Y0&1U#41u#43?1'3_1)2{0+3_'63?&92{:&2{*82{-63_@%3?:-3?813?:13?=/3_E)3_1@3?C03?*K3_B53_"),t(3,"#$'`#$*u#%)-#%+]%%(I#')s'%()%')Q''(k%))s''*{)'*9'+*7(.(k*(+a%2)s2$*{$4*{'4*Y(2+a)4*{3*+a1.+a3.+a9*+a)?*{=++AB'+aH$+A<2+a$M+aF-+a6@+a*O+a1J+a-Q+a-T+a1S+a9N+aEE+a"),t(2,"#$&@#$(s#%'i#'&?%%')#'(S$''m%'(1'''K%)(S+&'K'*(3'/')(.'K*.'K0&(U4%(36%(33,'m-2(S)6(u#E'k13(U%A(u09(U'D(u?/(UB.(U=6(U<:(U?:(UF6(UQ.(U$^(uL9(Uc%(UQ;(UCM(Uf-(U`7(U")],e={min:0,L:0,M:1,Q:2,H:3,max:3},n=t=>"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(t),r=t=>t.charCodeAt(0),s=(...t)=>(o,e)=>t.forEach((t=>t(o,e))),c=t=>o=>{o.eci!==t&&(o.push(7,4),o.push(t,8),o.eci=t)},i=t=>(o,e)=>{o.push(4,4),o.push(t.length,8+8*(e>9)),t.forEach((t=>o.push(t,8)))},f=(t,o,e,n)=>{const r=n?o=>s(c(n),t(o)):t;return r.test=o,r.est=e,r.eci=n,r},a=f((t=>(o,e)=>{o.push(1,4),o.push(t.length,10+2*(e>26)+2*(e>9));let n=0;for(;n<t.length-2;n+=3)o.push(+t.slice(n,n+3),10);n<t.length-1?o.push(+t.slice(n,n+2),7):n<t.length&&o.push(+t[n],4)}),/./.test.bind(/[0-9]/),((t,o)=>14+2*(o>26)+2*(o>9)+10*t.length/3)),l=f((t=>(o,e)=>{o.push(2,4),o.push(t.length,9+2*(e>26)+2*(e>9));let r=0;for(;r<t.length-1;r+=2)o.push(45*n(t[r])+n(t[r+1]),11);r<t.length&&o.push(n(t[r]),6)}),(t=>n(t)>=0),((t,o)=>13+2*(o>26)+2*(o>9)+5.5*t.length)),u=f((t=>i([...t].map(r))),(t=>r(t)<128),((t,o)=>12+8*(o>9)+8*t.length)),h=f(u,(t=>r(t)<256),u.est,3),m=new TextEncoder,d=f((t=>i(m.encode(t))),(()=>1),((t,o)=>12+8*(o>9)+8*m.encode(t).length),26),$=t=>t.reduce(((t,o)=>o.e<t.e?o:t)),w=[a,l,u,h,d],g=(t,{modes:o=w}={})=>(e,n)=>{let r=[{e:0}];for(let e=0;e<t.length;++e)if(r=o.filter((o=>o.test(t[e]))).map((o=>$(r.map((r=>{const s=r.m===o?r.s:e,c=r.m===o?r.p:r,i=t.slice(s,e+1),f=o.eci??c.i;return{m:o,p:c,s:s,v:i,e:c.e+12*(f!==c.i)+Math.ceil(o.est(i,n)),i:f}}))))),!r.length)throw new Error("Unencodable");const s=[];for(let t=$(r);t.m;t=t.p)s.unshift(t.m(t.v));s.forEach((t=>t(e,n)))};class U{constructor(t){this.t=new Uint8Array(t),this.o=0}push(t,o){for(let e=o,n=8-(7&this.o);e>0;e-=n,n=8)this.t[this.o>>>3]|=t<<n>>>e,this.o+=e<n?e:n}}class p{constructor({size:t,d:o}){this.size=t,this.d=new Uint8Array(o||t*t)}get=(t,o)=>t>=0&&t<this.size&&!!(1&this.d[o*this.size+t]);l=(t,o)=>2&this.d[o*this.size+t];u(t,o,e,n=1){this.d[o*this.size+t]=2*n|!!e}h(t,o){this.d[o*this.size+t]^=1}toString({on:t="##",off:o="  ",lf:e="\n",padX:n=4,padY:r=4}={}){let s="";for(let c=-r;c<this.size+r;++c){for(let e=-n;e<this.size+n;++e)s+=this.get(e,c)?t:o;s+=e}return s}toImageData(t,{on:o=[0,0,0],off:e=[0,0,0,0],padX:n=4,padY:r=4}={}){const s=this.size+2*n,c=this.size+2*r,i=t.createImageData(s,c),f=new Uint32Array(i.data.buffer);i.data.set([...o,255]);const a=f[0];i.data.set([...e,255]);const l=f[0];for(let t=0;t<c;++t)for(let o=0;o<s;++o)f[t*s+o]=this.get(o-n,t-r)?a:l;return i}toCanvas(t,o){const e=t.getContext("2d"),n=this.toImageData(e,o);t.width=n.width,t.height=n.height,e.putImageData(n,0,0)}toDataURL({type:t="image/png",scale:o=1,...e}={}){const n=document.createElement("canvas"),r=n.getContext("2d"),s=this.toImageData(r,e);return n.width=s.width*o,n.height=s.height*o,r.putImageData(s,0,0),r.imageSmoothingEnabled=!1,r.globalCompositeOperation="copy",r.drawImage(n,0,0,s.width,s.height,0,0,n.width,n.height),n.toDataURL(t,1)}}const v=[(t,o)=>!(1&(t^o)),(t,o)=>!(1&o),t=>!(t%3),(t,o)=>!((t+o)%3),(t,o)=>!(1&((t/3|0)^o>>1)),(t,o)=>!((t&o&1)+t*o%3),(t,o)=>!((t&o&1)+t*o%3&1),(t,o)=>!((1&(t^o))+t*o%3&1)],A=new Uint8Array(512);A[0]=1;for(let t=0,o=1;t<255;A[++t]=o)A[o+256]=t,o*=2,256&o&&(o^=285);const M=t=>A[t%255],b=t=>A[t+256],k=(t,o)=>{const e=new Uint8Array(t.length+o.length-1);for(let n=0;n<t.length;++n)for(let r=0;r<o.length;++r)e[n+r]^=M(t[n]+o[r]);return e.map(b)},x=(t,o)=>{const e=new Uint8Array(t.length+o.length-1);e.set(t,0);for(let n=0;n<t.length;++n)if(e[n]){const t=b(e[n]);for(let r=0;r<o.length;++r)e[n+r]^=M(o[r]+t)}return e.slice(t.length)},y=[[0],[0,0]];for(let t=1,o=y[1];t<30;++t){const e=k(o,[0,t]);y.push(e),o=e}const K=(t,o)=>{const e=[[],[]];let n=0,r=0;for(const[s,c]of o.g)for(let i=0;i<s;++i,n+=c){const s=t.slice(n,n+c);e[0].push(s),e[1].push(x(s,y[o.s])),r+=c+o.s}const s=new Uint8Array(r);let c=0;for(const t of e)for(let o,e=0;c!==o;++e){o=c;for(const o of t)e<o.length&&(s[c++]=o[e])}return s},E=(t,o,e)=>{let n=t<<e-1;for(let t=134217728;t;t>>>=1)n&t&&(n^=o*(t>>>e-1));return n},L=(t,o,e,n,r,s)=>{for(let c=e;c<r;++c)for(let e=o;e<n;++e)t.u(e,c,s)},C=(t,o,e)=>{L(t,o-3,e-3,o+4,e+4,1),L(t,o-2,e-2,o+3,e+3,0),L(t,o-1,e-1,o+2,e+2,1)},_=(t,o,e)=>{L(t,o-2,e-2,o+3,e+3,1),L(t,o-1,e-1,o+2,e+2,0),t.u(o,e,1)},S=(t,o)=>{const e=4*o+17;C(t,3,3),C(t,e-4,3),C(t,3,e-4),L(t,0,7,9,9,0),L(t,7,0,9,7,0),L(t,e-8,7,e,9,0),L(t,e-8,0,e-7,7,0),L(t,7,e-8,9,e,0),L(t,0,e-8,7,e-7,0),t.u(8,e-8,1);for(let o=8;o<e-8;++o)t.u(o,6,!(1&o)),t.u(6,o,!(1&o));if(o>=2){const n=1+(o/7|0),r=2*((e-13)/n/2+.75|0),s=[6];for(let t=n;t-- >0;)s.push(e-7-t*r);for(let o=0;o<=n;++o)for(let e=0;e<=n;++e)!o&&!e||!o&&e===n||o===n&&!e||_(t,s[o],s[e])}if(o>=7)for(let n=o<<12|E(o,7973,13),r=0;r<6;++r)for(let o=12;o-- >9;n>>>=1)t.u(r,e-o,1&n),t.u(e-o,r,1&n)},H=t=>{const o=t.size,e=[];for(let n=o-2,r=o,s=-1;n>=0;n-=2){for(5===n&&(n=4);r+=s,-1!==r&&r!==o;)t.l(n+1,r)||e.push([n+1,r]),t.l(n,r)||e.push([n,r]);s*=-1}return e},Q=(t,o,e)=>{o.forEach((([o,n],r)=>t.u(o,n,e[r>>3]<<(7&r)&128,0)))},B=(t,o,e,n)=>{const r=t.size;for(let e=0;e<r;++e)for(let n=0;n<r;++n)o(n,e)&&!t.l(n,e)&&t.h(n,e);const s=n<<3|e;let c=21522^(s<<10|E(s,1335,11));for(let o=8;o-- >0;c>>=1)t.u(8,(o>1?7:8)-o,1&c),t.u(r-8+o,8,1&c);for(let o=7;o-- >0;c>>=1)t.u(o>5?7:o,8,1&c),t.u(8,r-o-1,1&c)},I=(t,o,e)=>{for(let n=0;n<t.size;++n){let r=o,s=o;for(let o=0;o<t.size;++o)r=e(r,t.get(o,n)),s=e(s,t.get(n,o))}},Y=t=>(t=>{let o=0;return I(t,[0],(([t,e],n)=>n!==e?[1,n]:(4===t?o+=3:t>4&&++o,[t+1,e]))),o})(t)+3*(t=>{let o=0;for(let e=1;e<t.size;++e){let n=t.get(e-1,0),r=t.get(e,0)===n;for(let s=1;s<t.size;++s){const c=t.get(e-1,s),i=t.get(e,s)===c;o+=r&&i&&n===c,n=c,r=i}}return o})(t)+40*(t=>{let o=0;return I(t,0,((t,e)=>{const n=(t>>>1|2098176)&(3047517^e-1);return 2049&n&&++o,n})),o})(t)+(t=>{let o=0;for(let e=0;e<t.size;++e)for(let n=0;n<t.size;++n)o+=t.get(n,e);return 10*(20*Math.abs(o/(t.size*t.size)-.5)|0)})(t),D=[],N=(t,{minCorrectionLevel:n=e.min,maxCorrectionLevel:r=e.max,minVersion:s=1,maxVersion:c=40,mask:i,...f}={})=>{if(r<n)throw new Error("Bad correction range");if(c<s)throw new Error("Bad version range");"string"==typeof t&&(t=g(t,f));for(let e=s,f=0;e<=c;++e){if(o[n][e-1].c<f)continue;const s=new U(2956);t(s,e),f=s.o;for(let t=r;t>=n;--t){const n=o[t][e-1];if(n.c<f)continue;for(s.push(0,4),s.o=s.o+7&-8;s.o<n.c;)s.push(60433,16);let r=D[e];r||(D[e]=r=new p({size:4*e+17}),S(r,e),r.p=H(r));const c=new p(r);return Q(c,r.p,K(s.t,n)),(v[i??-1]?[v[i]]:v).map(((t,o)=>{const e=new p(c);return B(e,t,i??o,n.i),e.s=Y(e),e})).reduce(((t,o)=>o.s<t.s?o:t))}}throw new Error("Too much data")};N.with=(...t)=>(o,e)=>N(o,{modes:[...w,...t],...e});const T="http://www.w3.org/2000/svg",V=/[^-a-zA-Z0-9 .,:/#%()]/g,F=(t,o,e,n=[],r=t.createElementNS(T,o))=>(Object.entries(e).forEach((([t,o])=>r.setAttribute(t,o))),r.replaceChildren(...n),r),J=(t,o,e=[])=>[`<${t}`,...Object.entries(o).map((([t,o])=>` ${t}="${`${o}`.replaceAll(V,"")}"`)),">",...e,`</${t}>`].join(""),O=t=>{const o=new Map,e=[],n=t=>{const e=o.get(t);return o.delete(t),e};for(let r=0;r<=t.size;++r)for(let s=0;s<=t.size;++s){const c=t.get(s,r),i=t.get(s,r-1),f=[t.get(s-1,r)!==c&&s+" "+(r+1),s+" "+r,i!==c&&s+1+" "+r].filter((t=>t));if(f.length>1){c||f.reverse();const t=f.pop(),r=n(f[0])||[],s=n(t);r.push(...f),r===s?e.push(r):(s?s.unshift(...r):o.set(t,r),o.set(r[0],s||r))}}return e.map((t=>`M${t.join("L")}Z`)).join("")},X=(t,{on:o="black",off:e,padX:n=4,padY:r=4,width:s,height:c,scale:i=1},f,a)=>{const l=t.size+2*n,u=t.size+2*r;return f("svg",{xmlns:T,version:"1.1",viewBox:`${-n} ${-r} ${l} ${u}`,width:s??l*i,height:c??u*i,"shape-rendering":"crispedges"},[e?f("rect",{x:-n,y:-r,width:l,height:u,fill:e}):"",f("path",{d:O(t),fill:o})],a)},j=(t,o)=>"data:image/svg;base64,"+btoa(((t,o={})=>(o.xmlDeclaration?'<?xml version="1.0" encoding="UTF-8" ?>':"")+X(t,o,J))(t,{xmlDeclaration:1,...o})),q=new Map,z=new TextDecoder("sjis"),Z=new Uint8Array(2);for(const[t,o,e]of[[33088,40957,33088],[57408,60352,49472]])for(let n=t;n<o;++n){Z[0]=n>>8,Z[1]=255&n;const t=n-e,o=z.decode(Z);"\ufffd"===o||q.has(o)||q.set(o,192*(t>>8)+(255&t))}const G=t=>(o,e)=>{o.push(8,4),o.push(t.length,8+2*(e>26)+2*(e>9));for(const e of t)o.push(q.get(e),13)};G.test=t=>q.has(t),G.est=(t,o)=>12+2*(o>26)+2*(o>9)+13*t.length;const R=t=>document.querySelector(`[name="${t}"]`),W=t=>R(t).value;function P(t,o,e){const n=Number.parseInt(W(t),10);return Number.isNaN(n)?o:Math.max(o,Math.min(e,Math.round(n)))}function tt(t){const o=Number.parseInt(W(t).slice(1),16);return[o>>16&255,o>>8&255,255&o,255]}function ot(){const t=W("mask");return"auto"===t?null:Number(t)}const et=document.getElementById("error"),nt=document.querySelector("#output canvas"),rt=document.querySelector("#output pre"),st=document.querySelector("#output svg"),ct=document.querySelector("#download .png"),it=document.querySelector("#download .svg");let ft=null;const at=N.with(G);function lt(){ft=null,nt.style.display="none",rt.style.display="none",st.style.display="none",et.style.display="none",ct.removeAttribute("href"),it.removeAttribute("href");try{const t=at(W("message"),{minVersion:P("min-version",1,40),maxVersion:P("max-version",1,40),minCorrectionLevel:e[W("min-correction")],maxCorrectionLevel:e[W("max-correction")],mask:ot()});switch(ft=t,ct.setAttribute("href","#"),it.setAttribute("href","#"),W("format")){case"canvas":t.toCanvas(nt,{on:tt("on"),off:tt("off")}),nt.style.display="block";break;case"text":rt.innerText=t.toString({on:"\u2588\u2588",off:"  "}),rt.style.color=W("on"),rt.style.background=W("off"),rt.style.transform=`scale(${29/(t.size+8)})`,rt.style.display="inline-block";break;case"svg":((t,o,e={})=>{o.body?X(t,e,F.bind(0,o)):X(t,e,F.bind(0,o.ownerDocument),o)})(t,st,{on:W("on"),off:W("off")}),st.style.display="block"}}catch(t){et.innerText=t.message,et.style.display="block"}}ct.addEventListener("click",(t=>{if(!ft)return void t.preventDefault();const o=ft.toDataURL({type:"image/png",on:tt("on"),off:tt("off"),scale:10});ct.setAttribute("href",o)})),it.addEventListener("click",(t=>{if(!ft)return void t.preventDefault();const o=j(ft,{on:W("on"),off:W("off"),scale:10});it.setAttribute("href",o)})),document.querySelectorAll("input, select, textarea").forEach((t=>t.addEventListener("input",lt))),document.getElementById("reverse-col").addEventListener("click",(()=>{const t=R("on"),o=R("off"),e=t.value,n=o.value;t.value=n,o.value=e,lt()})),lt();
