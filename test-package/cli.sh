#!/bin/sh
set -e

EXPECTED="$(cat <<EOF
##############........##....##############
##..........##......##..##..##..........##
##..######..##..##..##......##..######..##
##..######..##..##....####..##..######..##
##..######..##..##..######..##..######..##
##..........##..##..##..##..##..........##
##############..##..##..##..##############
................##....####................
##..##########......##..##..##########....
....##..##....####......##......######..##
####..##....######..####..####....######..
########..........####....##......####....
##..##..##..####....####..####....##..##..
................####....##....####..######
##############......##..######....##..##..
##..........##..############......####....
##..######..##..##..######..##..####..####
##..######..##..######........########....
##..######..##..##..########........##....
##..........##........##..##..##....##....
##############..####..####..####......##..
EOF
)";

ACTUAL="$(npm --prefix "$(dirname "$0")" exec --offline -- lean-qr -f text-ascii -p0 'test message' | tr ' ' '.')";

if [ "$ACTUAL" != "$EXPECTED" ]; then
  echo "Unexpected output from CLI" >&2;
  echo "$ACTUAL";
  exit 1;
fi;
