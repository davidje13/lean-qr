{"version":3,"file":"svg.js","sources":["../../src/extras/svg.mjs"],"sourcesContent":["const SVG_NS = 'http://www.w3.org/2000/svg';\nconst UNSAFE = /[^-a-zA-Z0-9 .:/#%]/g;\n\nconst make = (d, tag, attrs, children = [], existing) => {\n  const o = existing || d.createElementNS(SVG_NS, tag);\n  Object.entries(attrs).forEach(([k, v]) => o.setAttribute(k, v));\n  o.replaceChildren(...children);\n  return o;\n};\n\nconst makeSrc = (tag, attrs, children = []) =>\n  [\n    `<${tag}`,\n    ...Object.entries(attrs).map(\n      ([k, v]) => ` ${k}=\"${String(v).replaceAll(UNSAFE, '')}\"`,\n    ),\n    '>',\n    ...children,\n    `</${tag}>`,\n  ].join('');\n\nconst getAndDelete = (map, key) => {\n  const v = map.get(key);\n  map.delete(key);\n  return v;\n};\n\nexport const toSvgPath = (code) => {\n  const anchors = new Map();\n  const paths = [];\n  for (let y = 0; y <= code.size; ++y) {\n    for (let x = 0; x <= code.size; ++x) {\n      const v5 = code.get(x, y);\n      const v2 = code.get(x, y - 1);\n      const v4 = code.get(x - 1, y);\n      if (v5 === v2 && v5 === v4) {\n        continue;\n      }\n\n      const f = [\n        v4 !== v5 && x + ' ' + (y + 1),\n        x + ' ' + y,\n        v2 !== v5 && x + 1 + ' ' + y,\n      ].filter((v) => v);\n      if (!v5) {\n        f.reverse();\n      }\n\n      const end = f.pop();\n      const a = getAndDelete(anchors, f[0]) || [];\n      const b = getAndDelete(anchors, end);\n      a.push(...f);\n      if (a === b) {\n        paths.push(a);\n        continue;\n      }\n      if (b) {\n        b.unshift(...a);\n      } else {\n        anchors.set(end, a);\n      }\n      anchors.set(a[0], b || a);\n    }\n  }\n\n  return paths.map((p) => `M${p.join('L')}Z`).join('');\n};\n\nconst toSvgInternal = (\n  code,\n  { on = 'black', off, padX = 4, padY = 4, width, height, scale = 1 },\n  mk,\n  target,\n) => {\n  const w = code.size + padX * 2;\n  const h = code.size + padY * 2;\n  return mk(\n    'svg',\n    {\n      xmlns: SVG_NS,\n      version: '1.1',\n      viewBox: `${-padX} ${-padY} ${w} ${h}`,\n      width: width ?? w * scale,\n      height: height ?? h * scale,\n      'shape-rendering': 'crispedges',\n    },\n    [\n      off\n        ? mk('rect', {\n            x: -padX,\n            y: -padY,\n            width: w,\n            height: h,\n            fill: off,\n          })\n        : '',\n      mk('path', { d: toSvgPath(code), fill: on }),\n    ],\n    target,\n  );\n};\n\nexport const toSvg = (code, svg, options = {}) =>\n  svg.body\n    ? toSvgInternal(code, options, make.bind(null, svg))\n    : toSvgInternal(code, options, make.bind(null, svg.ownerDocument), svg);\n\nexport const toSvgSource = (code, options = {}) =>\n  (options.xmlDeclaration ? '<?xml version=\"1.0\" encoding=\"UTF-8\" ?>' : '') +\n  toSvgInternal(code, options, makeSrc);\n\nexport const toSvgDataURL = (code, options) =>\n  'data:image/svg;base64,' +\n  btoa(toSvgSource(code, { xmlDeclaration: true, ...options }));\n"],"names":["SVG_NS","UNSAFE","make","d","tag","attrs","children","existing","arguments","length","undefined","o","createElementNS","Object","entries","forEach","_ref","k","v","setAttribute","replaceChildren","makeSrc","map","_ref2","String","replaceAll","join","getAndDelete","key","get","delete","toSvgPath","code","anchors","Map","paths","y","size","x","v5","v2","v4","f","filter","reverse","end","pop","a","b","push","unshift","set","p","toSvgInternal","mk","target","on","off","padX","padY","width","height","scale","_ref3","w","h","xmlns","version","viewBox","fill","toSvgSource","options","xmlDeclaration","svg","body","bind","ownerDocument","btoa"],"mappings":"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"}