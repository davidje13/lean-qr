{"version":3,"file":"svg.js","sources":["../../src/extras/svg.mjs"],"sourcesContent":["const SVG_NS = 'http://www.w3.org/2000/svg';\nconst UNSAFE = /[^-a-zA-Z0-9 .:/#%]/g;\n\nconst make = (d, tag, attrs, children = [], existing) => {\n  const o = existing || d.createElementNS(SVG_NS, tag);\n  Object.entries(attrs).forEach(([k, v]) => o.setAttribute(k, v));\n  o.replaceChildren(...children);\n  return o;\n};\n\nconst makeSrc = (tag, attrs, children = []) =>\n  [\n    `<${tag}`,\n    ...Object.entries(attrs).map(\n      ([k, v]) => ` ${k}=\"${String(v).replaceAll(UNSAFE, '')}\"`,\n    ),\n    '>',\n    ...children,\n    `</${tag}>`,\n  ].join('');\n\nconst getAndDelete = (map, key) => {\n  const v = map.get(key);\n  map.delete(key);\n  return v;\n};\n\nexport const toSvgPath = (code) => {\n  const s = code.size;\n  const get = (x, y) => x >= 0 && x < s && y >= 0 && y < s && code.get(x, y);\n\n  const anchors = new Map();\n  const paths = [];\n  for (let y = 0; y <= s; ++y) {\n    for (let x = 0; x <= s; ++x) {\n      const v5 = get(x, y);\n      const v2 = get(x, y - 1);\n      const v4 = get(x - 1, y);\n      if (v5 === v2 && v5 === v4) {\n        continue;\n      }\n\n      const f = [\n        v4 !== v5 && x + ' ' + (y + 1),\n        x + ' ' + y,\n        v2 !== v5 && x + 1 + ' ' + y,\n      ].filter((v) => v);\n      if (!v5) {\n        f.reverse();\n      }\n\n      const end = f.pop();\n      const a = getAndDelete(anchors, f[0]) || [];\n      const b = getAndDelete(anchors, end);\n      a.push(...f);\n      if (a === b) {\n        paths.push(a);\n        continue;\n      }\n      if (b) {\n        b.unshift(...a);\n      } else {\n        anchors.set(end, a);\n      }\n      anchors.set(a[0], b || a);\n    }\n  }\n\n  return paths.map((p) => `M${p.join('L')}Z`).join('');\n};\n\nconst toSvgInternal = (\n  code,\n  { on = 'black', off, padX = 4, padY = 4, width, height, scale = 1 },\n  mk,\n  target,\n) => {\n  const w = code.size + padX * 2;\n  const h = code.size + padY * 2;\n  return mk(\n    'svg',\n    {\n      xmlns: SVG_NS,\n      version: '1.1',\n      viewBox: `${-padX} ${-padY} ${w} ${h}`,\n      width: width ?? w * scale,\n      height: height ?? h * scale,\n    },\n    [\n      off\n        ? mk('rect', {\n            x: -padX,\n            y: -padY,\n            width: w,\n            height: h,\n            fill: off,\n          })\n        : '',\n      mk('path', { d: toSvgPath(code), fill: on }),\n    ],\n    target,\n  );\n};\n\nexport const toSvg = (code, svg, options = {}) =>\n  svg.body\n    ? toSvgInternal(code, options, make.bind(null, svg))\n    : toSvgInternal(code, options, make.bind(null, svg.ownerDocument), svg);\n\nexport const toSvgSource = (code, options = {}) =>\n  toSvgInternal(code, options, makeSrc);\n"],"names":["SVG_NS","UNSAFE","make","d","tag","attrs","children","existing","o","createElementNS","Object","entries","forEach","_ref","k","v","setAttribute","replaceChildren","makeSrc","map","_ref2","String","replaceAll","join","getAndDelete","key","get","delete","toSvgPath","code","s","size","x","y","anchors","Map","paths","v5","v2","v4","f","filter","reverse","end","pop","a","b","push","unshift","set","p","toSvgInternal","mk","target","on","off","padX","padY","width","height","scale","w","h","xmlns","version","viewBox","fill","svg","options","body","bind","ownerDocument"],"mappings":"oEAAA,MAAMA,EAAS,6BACTC,EAAS,uBAETC,EAAO,SAACC,EAAGC,EAAKC,OAAOC,yDAAW,GAAIC,+CACpCC,EAAID,GAAYJ,EAAEM,gBAAgBT,EAAQI,UAChDM,OAAOC,QAAQN,GAAOO,SAAQC,QAAEC,EAAGC,YAAOP,EAAEQ,aAAaF,EAAGC,MAC5DP,EAAES,mBAAmBX,GACdE,GAGHU,EAAU,SAACd,EAAKC,OAAOC,yDAAW,SACtC,CACG,IAAGF,OACDM,OAAOC,QAAQN,GAAOc,KACvBC,QAAEN,EAAGC,WAAQ,IAAGD,MAAMO,OAAON,GAAGO,WAAWrB,EAAQ,UAErD,OACGK,EACF,KAAIF,MACLmB,KAAK,KAEHC,EAAe,CAACL,EAAKM,WACnBV,EAAII,EAAIO,IAAID,UAClBN,EAAIQ,OAAOF,GACJV,GAGIa,EAAaC,UAClBC,EAAID,EAAKE,KACTL,EAAM,CAACM,EAAGC,IAAMD,GAAK,GAAKA,EAAIF,GAAKG,GAAK,GAAKA,EAAIH,GAAKD,EAAKH,IAAIM,EAAGC,GAElEC,EAAU,IAAIC,IACdC,EAAQ,OACT,IAAIH,EAAI,EAAGA,GAAKH,IAAKG,MACnB,IAAID,EAAI,EAAGA,GAAKF,IAAKE,EAAG,OACrBK,EAAKX,EAAIM,EAAGC,GACZK,EAAKZ,EAAIM,EAAGC,EAAI,GAChBM,EAAKb,EAAIM,EAAI,EAAGC,MAClBI,IAAOC,GAAMD,IAAOE,iBAIlBC,EAAI,CACRD,IAAOF,GAAML,EAAI,KAAOC,EAAI,GAC5BD,EAAI,IAAMC,EACVK,IAAOD,GAAML,EAAI,EAAI,IAAMC,GAC3BQ,QAAQ1B,GAAMA,IACXsB,GACHG,EAAEE,gBAGEC,EAAMH,EAAEI,MACRC,EAAIrB,EAAaU,EAASM,EAAE,KAAO,GACnCM,EAAItB,EAAaU,EAASS,GAChCE,EAAEE,QAAQP,GACNK,IAAMC,GAINA,EACFA,EAAEE,WAAWH,GAEbX,EAAQe,IAAIN,EAAKE,GAEnBX,EAAQe,IAAIJ,EAAE,GAAIC,GAAKD,IARrBT,EAAMW,KAAKF,UAYVT,EAAMjB,KAAK+B,GAAO,IAAGA,EAAE3B,KAAK,UAASA,KAAK,KAG7C4B,EAAgB,CACpBtB,IAEAuB,EACAC,SAFAC,GAAEA,EAAK,QAAPC,IAAgBA,EAAhBC,KAAqBA,EAAO,EAA5BC,KAA+BA,EAAO,EAAtCC,MAAyCA,EAAzCC,OAAgDA,EAAhDC,MAAwDA,EAAQ,WAI1DC,EAAIhC,EAAKE,KAAc,EAAPyB,EAChBM,EAAIjC,EAAKE,KAAc,EAAP0B,SACfL,EACL,MACA,CACEW,MAAO/D,EACPgE,QAAS,MACTC,QAAU,IAAGT,MAASC,KAAQI,KAAKC,IACnCJ,MAAOA,GAASG,EAAID,EACpBD,OAAQA,GAAUG,EAAIF,GAExB,CACEL,EACIH,EAAG,OAAQ,CACTpB,GAAIwB,EACJvB,GAAIwB,EACJC,MAAOG,EACPF,OAAQG,EACRI,KAAMX,IAER,GACJH,EAAG,OAAQ,CAAEjD,EAAGyB,EAAUC,GAAOqC,KAAMZ,KAEzCD,kBAIiB,SAACxB,EAAMsC,OAAKC,yDAAU,UACzCD,EAAIE,KACAlB,EAActB,EAAMuC,EAASlE,EAAKoE,KAAK,KAAMH,IAC7ChB,EAActB,EAAMuC,EAASlE,EAAKoE,KAAK,KAAMH,EAAII,eAAgBJ,4CAE5C,SAACtC,OAAMuC,yDAAU,UAC1CjB,EAActB,EAAMuC,EAASlD"}